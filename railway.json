{
  "$schema": "https://backboard.railway.app/railway.schema.json",
  "build": {
    "builder": "RAILPACK",
    "buildCommand": "bun install && bun run db:generate",
    "watchPatterns": ["src/**", "package.json", "tsconfig.json", "drizzle.config.ts"]
  },
  "deploy": {
    "startCommand": "bun run start",
    "preDeployCommand": ["bun run db:migrate"],
    "healthcheckPath": "/health",
    "healthcheckTimeout": 30,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3,
    "numReplicas": 1,
    "region": "us-east4-eqdc4a",
    "sleepApplication": false
  },
  "environments": {
    "staging": {
      "build": {
        "buildCommand": "bun install && bun run db:generate"
      },
      "deploy": {
        "startCommand": "bun run start",
        "numReplicas": 1,
        "sleepApplication": true
      }
    },
    "production": {
      "build": {
        "buildCommand": "bun install && bun run db:generate"
      },
      "deploy": {
        "startCommand": "bun run start",
        "numReplicas": 2,
        "sleepApplication": false,
        "restartPolicyType": "ALWAYS",
        "restartPolicyMaxRetries": 5,
        "overlapSeconds": 30,
        "drainingSeconds": 10
      }
    }
  }
}
